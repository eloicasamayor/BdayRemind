import 'package:aniversaris/helpers/db_helper.dart';
import 'package:flutter/cupertino.dart';

import '../models/aniversari.dart';

class Aniversaris with ChangeNotifier {
  List<Aniversari> _aniversaris = [];

  List<Aniversari> get aniversaris {
    _aniversaris.sort(
      (a, b) => a.id.compareTo(b.id),
    );
    return [..._aniversaris];
  }

  List<Aniversari> get aniversarisOrdenatsPerNom {
    _aniversaris.sort(
      (a, b) => a.nom.compareTo(b.nom),
    );
    return _aniversaris;
  }

  List<Aniversari> get aniversarisOrdenatsPerData {
    _aniversaris.sort(
      (a, b) => a.dataNaixement.compareTo(b.dataNaixement),
    );
    return _aniversaris;
  }

  List<Aniversari> get aniversarisOrdenatsPerMes {
    _aniversaris.sort(
      (a, b) => a.dataNaixement.month.compareTo(b.dataNaixement.month),
    );
    return _aniversaris;
  }

  Future<void> addAniversari(
    String nomEscollit,
    DateTime dataNaixementEscollida,
  ) async {
    final mapGuardar = {
      'nom': nomEscollit,
      'dataNaixement': dataNaixementEscollida.toIso8601String(),
    };
    await DBHelper.insert('aniversaris', mapGuardar).then((autogeneratedId) {
      final nouAniversari = Aniversari(
        id: autogeneratedId,
        nom: nomEscollit,
        dataNaixement: dataNaixementEscollida,
      );
      _aniversaris.add(nouAniversari);
    });

    notifyListeners();
  }
}
